<!DOCTYPE html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="redux_reach-router"><meta name="author" content="Future Li"><meta name="keywords" content="redux,reach-router"><meta name="copyright" content="copyright.liscense_type"><title>Redux_reach-Router</title><!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]><script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script><script src="https://cdn.bootcss.com/respond/1.4.2/respond.min.js"></script><![endif]--><link rel="icon" href="/compass/imgs/favicon.ico"><link rel="stylesheet" href="/compass/stylesheets/font-awesome.min.css"><script>var algoliaConfig = {"on":false}</script><link rel="stylesheet" href="/compass/stylesheets/screen.css"><meta name="generator" content="Hexo 4.2.0"></head><body><div id="body-inner-wrapper"><header id="page-header"><nav id="nav"><div id="site-name">CodingLiveLi</div><i class="fa fa-bars fa-2x" id="nav-icon" aria-hidden="true"></i><div id="nav-expanded"><a class="nav-word-item" href="/">Home</a><a class="nav-word-item" href="/archives">Archives</a></div><div id="nav-list"><ul><li><a class="nav-list-item" href="/">Home</a></li><li><a class="nav-list-item" href="/archives">Archives</a></li></ul></div></nav><div id="banner-wrapper"><div id="banner-pagetype-dependent-info"><h1 id="post-title">Redux_reach-Router</h1><span id="post-description"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-07-11</span><span id="word-count">The total word count - 974</span><span id="time-count">Estimated time of reading - 4 mins</span></div></div><a title="Back to Top"><i class="fa fa-arrow-up" id="to-Top" aria-hidden="true"></i></a><a title="Click to Toggle off"><i class="fa fa-toggle-on" id="toggle-on-Toc" aria-hidden="true"></i></a><a title="Click to Toggle on"><i class="fa fa-toggle-off" id="toggle-off-Toc" aria-hidden="true"></i></a></header><aside id="toc-column"><div id="toc-column-inner-wrapper"><div id="post-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-text">Redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-text">核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-text">Action</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-text">Action Creator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-text">Thunk Action</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-text">Reducer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-text">Store</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-text">connect</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-text">Reach-Router</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-text">整个组件的rendering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-text">Navigate With Link</span></a></li></ol></li></ol></div></div></aside><main id="main-content-column"><div id="main-content-wrapper"><div id="post-full-content"><h1><span id="redux">Redux</span></h1><h2><span id="核心概念">核心概念</span></h2><h3><span id="action">Action</span></h3><p>一般的action就像新闻的摘要，包括标题（types）以及内容（payload）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//就是一般的对象</span></span><br><span class="line"><span class="comment">//官方demo的一个例子</span></span><br><span class="line"><span class="keyword">let</span> nextTodoID = <span class="number">0</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addTodo = <span class="function"><span class="params">text</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        type:<span class="string">'ADD_TODO'</span>,         <span class="comment">//返回的这个对象是修改之后的state</span></span><br><span class="line">        id:nextTodoID++,</span><br><span class="line">        text</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4><span id="action-creator">Action Creator</span></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一般的action返回对象</span></span><br><span class="line"><span class="comment">//在类组件中调用一般的action</span></span><br><span class="line"><span class="keyword">import</span> &#123; INCREMENT &#125; <span class="keyword">from</span> <span class="string">'../actions'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XXX</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    increment=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.dispatch(&#123;<span class="attr">type</span>:INCREMENT&#125;)      <span class="comment">//INCREMENT是action.js导出的字符串常量</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用Action Creator</span></span><br><span class="line"><span class="comment">//actions.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: INCREMENT &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//组件内</span></span><br><span class="line"><span class="keyword">import</span> &#123; increment &#125; <span class="keyword">from</span> <span class="string">'../actions'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XXX</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    increment=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.dispatch(increment())     </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用了mapDispatchToProps之后, 可以直接this.props.increment() 直接使用store里的dispatch</span></span><br></pre></td></tr></table></figure>

<ul>
<li>this.props.dispatch() 本身接受一个action对象,你可以直接在里面写action对象.</li>
<li>Action Creator 只是将这个action对象以函数执行的形式返回. 实际并没有区别. (?把type属性简化了)</li>
</ul>
<h4><span id="thunk-action">Thunk Action</span></h4><h3><span id="reducer">Reducer</span></h3><ul>
<li>接收两个参数,state和action,是一个纯函数,不修改传入的参数本身</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todos = <span class="function">(<span class="params">state=[], action</span>)=&gt;</span>&#123;      <span class="comment">//state=[]相当于初始化state</span></span><br><span class="line">    <span class="keyword">switch</span> (action.type)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                ...state,        <span class="comment">//这里是旧状态 , 类似setState,用新状态覆盖(?)旧状态 </span></span><br><span class="line">                &#123;                <span class="comment">//这里是新状态</span></span><br><span class="line">                    id:action.id,  <span class="comment">//旧状态包括在...state中, 新状态会将旧状态覆盖</span></span><br><span class="line">                    text:action.text,  </span><br><span class="line">                    completed:<span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</span><br><span class="line">            <span class="keyword">return</span> state.map(<span class="function"><span class="params">todo</span>=&gt;</span></span><br><span class="line">                (todo.id === action.id)?&#123;...todo,<span class="attr">completed</span>:!todo.completed&#125;:todo</span><br><span class="line">                )</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> todos</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在reducers/index.js将多个reducers合并起来</span></span><br><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> todos <span class="keyword">from</span> <span class="string">'./todos'</span></span><br><span class="line"><span class="keyword">import</span> visibilityFilter <span class="keyword">from</span> <span class="string">'./visibilityFilter'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todoApp = combineReducers(&#123;</span><br><span class="line">    todos,</span><br><span class="line">    visibilityFilter</span><br><span class="line">&#125;) <span class="comment">//注意这里和connect()的不同. connect接收的参数**不是**对象</span></span><br></pre></td></tr></table></figure>

<hr>
<h3><span id="store">Store</span></h3><p>action描述”发生了什么” , reducer根据action更新了state.</p>
<p>Store就是将它们联系起来的对象(?为什么要联系起来, reducer里不是传了action?)</p>
<ul>
<li>一个Redux应用必须只有一个store,如果需要拆分不同的逻辑处理,使用多个reducer处理</li>
</ul>
<hr>
<h3><span id="connect">connect</span></h3><p>将store和组件连接起来</p>
<p>是个高阶函数,<strong>将传入的组件封装成可以操作store的新组件</strong></p>
<p>redux并不依赖react, Vue,Express等等的框架都可以使用. </p>
<p>react-redux才是<strong>将react组件封装成可以操作store的新组件.</strong></p>
<p>connect可接收四个参数，</p>
<ol>
<li>mapStateToProps</li>
<li>mapDispatchToProps</li>
<li>mergeProps</li>
<li>options</li>
</ol>
<p>看前两个参数名字就知道,store的state,dispatch操作以props的形式传给对应组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, ownProps</span>) =&gt;</span> &#123;    <span class="comment">//状态修改</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    active: ownProps.filter === state.visibilityFilter</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch, ownProps</span>) =&gt;</span> &#123;   <span class="comment">//事件修改</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    onClick: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(setVisibilityFilter(ownProps.filter))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FilterLink = connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(Link)             <span class="comment">//这是个链式调用connect()(),使用到redux的组件</span></span><br><span class="line"><span class="comment">//这里的Link就是组件名称.</span></span><br></pre></td></tr></table></figure>

<p>因为Link这个组件需要使用redux,所以将其封装起来,装饰成<strong>一个可以操作store的,新的组件</strong></p>
<hr>
<h1><span id="reach-router">Reach-Router</span></h1><h2><span id="整个组件的rendering">整个组件的rendering</span></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Home = <span class="function"><span class="params">()</span>=&gt;</span><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> Hello Home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="keyword">let</span> About = <span class="function"><span class="params">()</span>=&gt;</span><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> Hello About <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">       &lt;Router&gt;</span><br><span class="line">         &lt;Home path=<span class="string">'/'</span> /&gt;</span><br><span class="line">         &lt;About path=<span class="string">'/about'</span> /&gt;</span><br><span class="line">       &lt;<span class="regexp">/Router&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root')</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>

<h2><span id="navigate-with-link">Navigate With Link</span></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Router , Link&#125; <span class="keyword">from</span> <span class="string">'@reach/router'</span></span><br><span class="line"><span class="keyword">let</span> Home = <span class="function"><span class="params">()</span>=&gt;</span>(                <span class="comment">//只允许一个根元素</span></span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Link to=<span class="string">"/"</span>&gt;Home&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">    &lt;Link to="about"&gt;About&lt;/</span>Link&gt;             <span class="comment">//这里的to对应&lt;Router&gt;里面的path</span></span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp">let About = ()=&lt;div&gt;About&lt;/</span>div&gt;</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;Home path=<span class="string">"/"</span> /&gt;</span><br><span class="line">    &lt;About path=<span class="string">"about"</span> /&gt;  <span class="comment">//这里加不加/不影响。</span></span><br><span class="line">  &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>

</div><div id="post-tags-container"><i class="fa fa-tags"></i> <a class="post-tag" href="/tags/redux/">#redux</a>  <a class="post-tag" href="/tags/reach-router/">#reach-router</a></div></div></main><div id="pagination-wrapper"><a id="page-prev" href="/2020/07/12/react-hooks/"><i class="fa fa-chevron-left"></i> react-hooks</a><a id="page-next" href="/2020/07/08/react%E5%AD%A6%E4%B9%A0/">react学习 <i class="fa fa-chevron-right"></i></a></div><footer id="page-footer"><div id="footer-wrapper"><div id="blog-meta">&copy;2017-2021 By Future Li | Theme - <a id='theme-name' href="https://github.com/huan555/lemon-lime" target="_blank" rel="noopener"> Lemon-Lime</a> | Power By <a id='theme-powered-by' href=http://hexo.io> Hexo</a></div><div id="viewed-record"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span></span></div><div id="copyright-wrapper"><i class="fa fa-cc" aria-hidden="true"></i><div id="copyright">Except where otherwise noted, content on this blog is licensed under <a rel="license" href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.</div></div><div id="contact-me"><div id="rss"><a href="/atom.xml" type="application/atom+xml" rel="alternate" target="_blank"><i class="fa fa-rss" aria-hidden="true"></i></a></div><span id="github"><a href="https://github.com/FutureProgrammerLi" target="_blank" rel="noopener"><i class="fa fa-github" aria-hidden="true"></i></a></span><span id="weibo"><a href="https://weibo.com/1903816767/profile?rightmod=1&amp;wvr=6&amp;mod=personnumber" target="_blank" rel="noopener"><i class="fa fa-weibo" aria-hidden="true"></i></a></span></div></div></footer><script src="/compass/js/blog.js"></script></div></body>