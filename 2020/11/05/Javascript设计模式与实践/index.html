<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Future Li">
  <!-- Open Graph Data -->
  <meta property="og:title" content="Javascript设计模式与实践"/>
  <meta property="og:description" content="Hello World!" />
  <meta property="og:site_name" content="CodingLiveLi"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://yoursite.com"/>
  
    <link rel="alternate" href="/atom.xml" title="CodingLiveLi" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>CodingLiveLi</title>

  <!-- Bootstrap CSS -->
  
<link rel="stylesheet" href="/css/bootstrap.min.css">

  <!-- Custom CSS -->
  
  
<link rel="stylesheet" href="/css/style.light.css">


  <!-- Google Analytics -->
  

<meta name="generator" content="Hexo 4.2.1"></head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">Javascript设计模式与实践</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/FutureProgrammerLi" target="_blank" rel="noopener">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:617612567@qq.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By Future Li</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2020-11-05</span>
            <span class="time">20:08:32</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a> / <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Javascript/">Javascript</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#设计模式</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <blockquote>
<p>之前在掘金有看到过比较有趣的设计模式的学习分享,也做了下笔记.</p>
<p><a href="https://codingliveli.netlify.app/2020/05/04/5-4%E6%97%A5%E8%AE%B0/" target="_blank" rel="noopener">https://codingliveli.netlify.app/2020/05/04/5-4日记/</a></p>
<p>这次是书本比较正式.仅摘抄些比较关键的,看到能联想到其它内容的词汇,内容.</p>
</blockquote>
<p>引言:</p>
<p>三部分： 1.Javascript面向对象和函数等基础 2.具体设计模式介绍 3.设计模式背后的思想原则。</p>
<hr>
<p>人的优势很大部分归于两点,懂得使用语言和懂得使用工具.</p>
<p>命名可以简要地概括一大段内容,比如足球领域的&quot;下底传中&quot;.    – 模式的命名</p>
<hr>
<p>一个没系统学习过,但做出了各种电子设备的人. 他终于获得了机会去学习, 课堂上的都是不懂的词汇,但他在实际运用中早已见过, 原来他只是不知道自己操作的零件,步骤是什么名字而已.</p>
<p>– 模式是人们在实践中归结出来的,为了解决某些问题而总结出来的,比较好的实践方式套路.</p>
<hr>
<p>人需要开飞机才能上天,而鸟天生就会飞翔</p>
<p>– 一些语言的有天生的优点,而其它语言则需要一些技巧才能实现.它们都能实现某些功能,不过方式、关注点可能不太一样.而模式就是指导它们这样做的思想。</p>
<p>– 模式应是一种思想，不该被语言的种类而限制。</p>
<hr>
<h3><span id="1单例模式-确保每个类只有一个实例并提供一个访问它的全局访问点"> 1.单例模式： 确保每个类只有一个实例，并提供一个访问它的全局访问点。</span></h3>
<p>如果是第一次实例化，就创建并返回一个对象。如果不是，就返回之前的那个对象。</p>
<p>以下例子便于理解，但不够’透明’：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.instance = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line">Singleton.getInstance = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">this</span>.Singleton)&#123;             <span class="comment">//未实例化过，就new一个.</span></span><br><span class="line">        <span class="keyword">this</span>.instance = <span class="keyword">new</span> Singleton(name);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.instance;     <span class="comment">//否则直接返回之前创建的.</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = Singleton.getInstance(<span class="string">'sven1'</span>);</span><br><span class="line"><span class="keyword">var</span> b = Singleton.getInstance(<span class="string">'sven2'</span>);</span><br><span class="line"></span><br><span class="line">a === b;      <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>不够透明，指每次获取实例都要通过getInstance方法。而通用的例子应该如下，每次访问都是像普通类一样new.（只管new，不管获取的是否为同一实例。只有看过类细节的人才知道是单例。）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CreateDiv = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> instance;</span><br><span class="line">    <span class="keyword">var</span> CreateDiv = <span class="function"><span class="keyword">function</span> (<span class="params">html</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance)&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">this</span>.html = html;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">        <span class="keyword">return</span> instance = <span class="keyword">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    CreateDiv.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        div.innerHTML = <span class="keyword">this</span>.html;</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> CreateDiv;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>JS中的单例模式，主要是避免全局污染而用某种方法将变量封装起来：</p>
<ol>
<li>命名空间:</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> namespace1 = &#123;</span><br><span class="line">    a:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'1'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    b:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'2'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>通过闭包将变量close up,只返回操作这些变量的方法, (读/写操作):</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> __name = <span class="string">'sven'</span>,</span><br><span class="line">        __age = <span class="number">29</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getUserInfo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> __name + <span class="string">'-'</span> + __age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p><strong>惰性单例</strong>， 不是每次一进来就创建单例，而是要使用的时候才创建。一般单例创建成本比较大，就要延迟创建它的时机（具体看应用场景）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div;</span><br><span class="line"><span class="keyword">if</span>(!div)&#123;</span><br><span class="line">    div = <span class="keyword">new</span> CreateDiv();     <span class="comment">//伪代码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> div;</span><br></pre></td></tr></table></figure>
<p>通用的惰性单例，将创建单例的细节，和判断是否为单例的功能分成两块（结合单一职责原则）:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getSingle = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line">    <span class="keyword">return</span> result || (result = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));   </span><br><span class="line">    <span class="comment">//不为null，直接返回之前的实例；为null就用传进来的构造函数进行构建。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，fn构造函数细节就可以抽出来，复用或者变化了, 从上面的div变成iframe / img / script等等都是可以的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createSingleIframe = getSingle(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(iframe);</span><br><span class="line">    <span class="keyword">return</span> iframe;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> createElement = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ele = <span class="built_in">document</span>.createElement(name);</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(ele);</span><br><span class="line">    <span class="keyword">return</span> ele;</span><br><span class="line">&#125;;</span><br><span class="line">getSingle(createElement(<span class="string">'div'</span>));</span><br><span class="line">getSingle(createElement(<span class="string">'script'</span>));</span><br><span class="line"><span class="comment">//...等等，自行扩展</span></span><br></pre></td></tr></table></figure>
<hr>
<h3><span id="2策略模式定义一系列算法把它们一个个封装起来并且使它们可以相互替换"> 2.策略模式：定义一系列算法，把它们一个个封装起来，并且使它们可以相互替换</span></h3>
<p>个人理解：策略模式是替代多个if-else语句的好方法。if-else看起来冗长，难以扩充及复用。</p>
<p>以下这段代码是根据业绩计算年终奖，评价S为工资4倍，A为工资3倍,类推…:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> calculateBonus = <span class="function"><span class="keyword">function</span>(<span class="params">level,salary</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(level === <span class="string">'S'</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> salary * <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(level === <span class="string">'A'</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> salary * <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(level === <span class="string">'B'</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> salary * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>缺点： 如果要加个评分C呢？ 如果将评分A的改为2.5倍呢？ 如果要逻辑堆叠起来，而不是直接返回呢？如果要在其它部分重用这里逻辑呢？（硬杠）</p>
<p><strong>策略模式的目的： 将算法的使用与算法的实现分离开来</strong></p>
<p>将使用策略的代码段拆成两个部分：策略类(方案)和 环境类(主观选择）。在环境类中维持对某个策略对象的引用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> strategies = &#123;</span><br><span class="line">    <span class="string">'S'</span>:<span class="function">(<span class="params">salary</span>) =&gt;</span> salary * <span class="number">4</span>,</span><br><span class="line">    <span class="string">'A'</span>:<span class="function">(<span class="params">salary</span>) =&gt;</span> salary * <span class="number">3</span>,</span><br><span class="line">    <span class="string">'B'</span>:<span class="function">(<span class="params">salary</span>) =&gt;</span> salary * <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> calculateBonus = <span class="function"><span class="keyword">function</span>(<span class="params">level,base</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> strategies[level](base);</span><br><span class="line">&#125;;</span><br><span class="line">calculateBonus(<span class="string">'S'</span>,<span class="number">20000</span>);      <span class="comment">//80000</span></span><br><span class="line">calculateBonus(<span class="string">'A'</span>,<span class="number">10000</span>);      <span class="comment">//30000</span></span><br></pre></td></tr></table></figure>
<p>应用：</p>
<ol>
<li>动画，让动画“动起来“的策略。</li>
<li>表单验证，除了整个表单的验证，还可以是表单单项的多项验证（比如密码，即要符合最小长度，又要符合必须含有字母和数字）</li>
</ol>
<p>以下主要是表单验证，整个表单的验证以及单项的多个验证策略。</p>
<p>整个表单验证,不好的写法是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">registerForm.onsubmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(registerForm.username.value === <span class="string">''</span>)&#123;</span><br><span class="line">        alert(<span class="string">'用户名不能为空'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(registerForm.password.value === <span class="string">''</span>)&#123;</span><br><span class="line">        alert(<span class="string">'密码不能为空'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="regexp">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test( registerForm.phoneNumber.value))&#123;</span><br><span class="line">        alert(<span class="string">'手机号码格式不正确'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>而用策略模式改写，个人认为并不是ifelse的问题，更多是便于扩充和提高可用性，将代码拆分出来。</p>
<p>策略类：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> strategies = &#123;</span><br><span class="line">    isNonEmpty: <span class="function"><span class="keyword">function</span>(<span class="params">value,errorMsg</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(value === <span class="string">''</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> errorMsg;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    minLength: <span class="function"><span class="keyword">function</span>(<span class="params">value,length,errorMsg</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(value.length &lt; length)&#123;</span><br><span class="line">            <span class="keyword">return</span> errorMsg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    isPhoneNumber: <span class="function"><span class="keyword">function</span>(<span class="params">value,errorMsg</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="regexp">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test(value))&#123;</span><br><span class="line">            <span class="keyword">return</span> errorMsg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>环境类：负责接收用户请求并委托给strategies对象。我觉得这里的Validator不仅好在分离了功能，还自带了缓存’业务’.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Validator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.cache = [];</span><br><span class="line">&#125;;</span><br><span class="line">Validator.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">dom,rule,errorMsg</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = rule.split(<span class="string">':'</span>);      <span class="comment">//minLength,6, minLength作为strategy出队了,但value,6仍然在arr中。</span></span><br><span class="line">    <span class="keyword">this</span>.cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> strategy = arr.shift();</span><br><span class="line">        arr.unshift(dom.value);</span><br><span class="line">        arr.push(errorMsg);</span><br><span class="line">        <span class="keyword">return</span> strategies[strategy].apply(dom,arr);        <span class="comment">//所以直接传arr也把minLength:6的6也传进去了</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">Validator.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, validotrFunc; validatorFunc = <span class="keyword">this</span>.cache[i++];)&#123;</span><br><span class="line">        <span class="keyword">var</span> msg = validorFunc();</span><br><span class="line">        <span class="keyword">if</span>(msg)&#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> validatorFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> validator = <span class="keyword">new</span> Validator();</span><br><span class="line">    </span><br><span class="line">    validator.add(registerForm.username,<span class="string">'isNonEmpty'</span>,<span class="string">'用户名不能为空'</span>);</span><br><span class="line">    validator.add(registerForm.password,<span class="string">'minLength:6'</span>,<span class="string">'密码最小长度为6'</span>);</span><br><span class="line">    validator.add(registerForm.phoen,<span class="string">'isPhoneNumber'</span>,<span class="string">'手机号码格式不正确'</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> errorMsg = validator.start();</span><br><span class="line">    <span class="keyword">return</span> errorMsg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>表单单项的多个校验规则，实际上就是把validator的第二和第三个参数整合成对象，然后传个对象数组进去而不是传两个字符串.</p>
<p>‘isNonEmpty’,‘用户名不能为空’ -&gt; [{strategy:‘isNonEmpty’,errorMsg:‘用户名不能为空’}]</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Validator.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">dom,rules</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, rule; rule = rules[i++];)&#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params">rule</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> strategyArr = rule.strategy.split(<span class="string">':'</span>);</span><br><span class="line">            <span class="keyword">var</span> errorMsg = rule.errorMsg;</span><br><span class="line">            self.cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> strategy = strategyArr.shift();</span><br><span class="line">                strategyArr.unshift(dom.value); <span class="comment">//unshift是为了保持value是校验规则的第一个参数</span></span><br><span class="line">                strategyArr.push(errorMsg);     <span class="comment">//push为了errorMsg是校验规则最后的参数.</span></span><br><span class="line">                <span class="keyword">return</span> strategies[strategy].apply(dom,strategyArr);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)(rule)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h3><span id="3代理模式"> 3.代理模式</span></h3>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->

<script src="/js/highlight.pack.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

