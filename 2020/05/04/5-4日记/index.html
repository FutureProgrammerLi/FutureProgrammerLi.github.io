<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Future Li">
  <!-- Open Graph Data -->
  <meta property="og:title" content="5-4日记"/>
  <meta property="og:description" content="What is this?" />
  <meta property="og:site_name" content="Hello!"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://yoursite.com"/>
  
    <link rel="alternate" href="/atom.xml" title="Hello!" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>Hello!</title>

  <!-- Bootstrap CSS -->
  
<link rel="stylesheet" href="/css/bootstrap.min.css">

  <!-- Custom CSS -->
  
  
<link rel="stylesheet" href="/css/style.light.css">


  <!-- Google Analytics -->
  

<meta name="generator" content="Hexo 4.2.0"></head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">5-4日记</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/FutureProgrammerLi" target="_blank" rel="noopener">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:617612567@qq.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By Future Li</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2020-05-04</span>
            <span class="time">01:20:06</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/%E6%95%B4%E7%90%86/">整理</a> / <a href="/categories/%E6%95%B4%E7%90%86/Javascript/">Javascript</a> / <a href="/categories/%E6%95%B4%E7%90%86/Javascript/%E6%97%A5%E8%AE%B0/">日记</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/Javascript/">#Javascript</a> <a class="tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#设计模式</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h2><span id="1js中的设计模式">1.JS中的设计模式</span></h2><h5><span id="什么是设计模式">什么是设计模式？</span></h5><p>套路。升级打怪的路线规划，避免浪费PL，利用最少的疲劳，最多的技巧，实现最快地升级。</p>
<p><code>模式是一种可复用的解决方案，用于解决软件设计中遇到的常见问题</code></p>
<p>100级刷什么图，做什么任务升级最快？有升级券吗？有经验胶囊吗？</p>
<p><strong>核心操作是：找出逻辑里的’变’与‘不变’，将它们分离。达到变的变灵活，不变的更稳定的目的。</strong></p>
<ol>
<li>策略模式</li>
</ol>
<p>为了实现某个功能，供有多种方案可选择。–灵活运用不同的方法，将优秀的方法抽取并组合起来。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简单的多种判定</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(data == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(data == <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(data == <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//问题=&gt;策略项无法复用,违反开闭原则</span></span><br></pre></td></tr></table></figure>

<p>使用策略模式改造代码:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jobList = [<span class="string">'FE'</span>,<span class="string">'BE'</span>]</span><br><span class="line"><span class="comment">//策略</span></span><br><span class="line"><span class="keyword">var</span> stratigies = &#123;</span><br><span class="line">    checkRole: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(value === <span class="string">'somerole'</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    checkGrade: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(value &gt;=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    checkJob: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(jobList.indexOf(value)!=<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//验证</span></span><br><span class="line"><span class="keyword">var</span> Validator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.cache = []</span><br><span class="line">    <span class="keyword">this</span>.resultSet = []</span><br><span class="line">    <span class="keyword">this</span>.add = <span class="function"><span class="keyword">function</span>(<span class="params">value,method</span>)</span>&#123; <span class="comment">//将策略放入数组中</span></span><br><span class="line">        <span class="keyword">this</span>.cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  <span class="comment">//必须使用闭包吗?为了保护value和method吗?</span></span><br><span class="line">            <span class="keyword">return</span> stratigies[method](value);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">this</span>.check = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;<span class="keyword">this</span>.cache.length;i++)&#123;</span><br><span class="line">            <span class="keyword">let</span> validFn = <span class="keyword">this</span>.cache[i]</span><br><span class="line">            <span class="keyword">let</span> res = validFn()</span><br><span class="line">            <span class="comment">//let res = this.cache[i]()</span></span><br><span class="line">            <span class="keyword">this</span>.resultSet.push(res)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.resultSet</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="keyword">var</span> example1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> validator = <span class="keyword">new</span> Validator()</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">        role:somerole,</span><br><span class="line">        grade:<span class="number">0</span>,</span><br><span class="line">        job:FE</span><br><span class="line">    &#125;</span><br><span class="line">    validator.add(data.role,<span class="string">'checkRole'</span>)</span><br><span class="line">    validator.add(data.grad,<span class="string">'checkGrade'</span>)</span><br><span class="line">    validator.add(data.job,<span class="string">'checkJob'</span>)</span><br><span class="line">    <span class="keyword">const</span> result = validator.check()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line">example1()</span><br></pre></td></tr></table></figure>

<ul>
<li>适用场景</li>
</ul>
<ol>
<li>判断逻辑互相独立且可复用</li>
<li>判断逻辑相对复杂</li>
<li>策略需要灵活组合</li>
</ol>
<p>将判断整合成类而不是每次判断的时候都重新写?</p>
<p>为什么不直接将需要<em>多个判断</em>的逻辑整合成一个函数而是将多个不同逻辑的判断整合成一个类?</p>
<hr>
<h2><span id="2发布订阅模式">2.发布/订阅模式</span></h2><p>一个事件完成后,需要通知其它事件更新相关数据.</p>
<p>例子:                      消息中心</p>
<p>申请成功 ===&gt;     订单</p>
<p>​                              审核员</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//没有使用模式的写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">success</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    MessageCenter.fetch();</span><br><span class="line">    Order.update();</span><br><span class="line">    Check.alert();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//情况:1.某个方法名被修改,则该函数也要改</span></span><br><span class="line"><span class="comment">//    2.要添加新的通知事件就要修改函数</span></span><br><span class="line"><span class="comment">//    3.任一函数/模块未完成,该功能都无法实现</span></span><br></pre></td></tr></table></figure>

<p><strong>发布/订阅模式</strong></p>
<p>​                                                     消息中心</p>
<p>申请成功 ==&gt;  EventEmit  ==&gt;  订单</p>
<p>​                                                      审核员</p>
<p><code>不将消息直接发送给订阅者,而由EventEmitter统一广播出去,订阅者通过订阅获取想要的信息</code></p>
<p>过去: ‘申请: “我搞定啦!你们什么时候才搞定阿?你们不搞定我也算没搞定的阿!”‘</p>
<p>​          订单(没完成的功能):” 快了快了!” (刚开始)</p>
<p>发布订阅: 申请:”我搞定啦! 你们搞定了自己去EventEmitter里拿吧!”</p>
<p>​                  消息中心,审核员(已完成功能):”好的,这就去!” (subscribe)</p>
<p>​                 订单(未完成):”这么快的吗!?”          ……(若干小时后)”我搞定啦!!! 人呢??!”(默默subscribe)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.events = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.on = <span class="function"><span class="keyword">function</span>(<span class="params">name,cb</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.events[name])&#123;</span><br><span class="line">            <span class="keyword">this</span>.events[name].push(cb)       <span class="comment">//为什么能用push?</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.events[name] = [cb]   <span class="comment">//函数作数组项?</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.trgger = <span class="function"><span class="keyword">function</span>(<span class="params">name,...arg</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.events[name])&#123;</span><br><span class="line">            <span class="keyword">this</span>.events[name].forEach(<span class="function"><span class="params">eventListener</span>=&gt;</span>&#123;</span><br><span class="line">                eventListener(...arg) <span class="comment">//遍历执行函数</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="keyword">let</span> event = <span class="keyword">new</span> EventEmit();</span><br><span class="line"></span><br><span class="line">MessageCenter.fetch()&#123;</span><br><span class="line">    event.on(<span class="string">'success'</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'通知消息中心'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">Order.update()&#123;</span><br><span class="line">    event.on(<span class="string">'success'</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'更新订单信息'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//? 被通知的函数需要先运行一次,订阅对应事件,之后每次trigger就能触发?</span></span><br><span class="line">event.trigger(<span class="string">'success'</span>)</span><br><span class="line">event.trigger(<span class="string">'success'</span>)</span><br><span class="line">event.trigger(<span class="string">'success'</span>)    <span class="comment">//每个订阅者都输出三次</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>on是订阅,订阅的事件名是自定义的,可以是一系列函数</p>
<p>第一次的events:       events[‘success’] = [cb1]</p>
<p>第二次: events[‘success’] = [cb1,cb2]      ==&gt;success就是统一的地方(集合区),cb就是各自的方法.</p>
</li>
<li><p>trigger是通知.遍历执行函数.(用for循环是不是好点?)</p>
<p>一次只能trigger一个数组内的函数?不能既触发success数组的函数,又触发fail(另一事件)数组的函数?</p>
</li>
<li><p>适用场景:</p>
<ol>
<li>各模块相互独立</li>
<li>存在一对多的依赖</li>
<li>依赖模块不稳定、依赖关系不稳定(依赖的经常崩,或者有时依赖有时又不依赖那个”一”的模块)</li>
</ol>
</li>
</ul>
<h2><span id="3装饰器模式适配器模式">3.装饰器模式/适配器模式</span></h2><p>装饰器模式: 在原有功能上进行加工,功能变得更完善,更”好看”.  //直接继承不香吗?</p>
<p>适配器模式: VGA转HDMI, USB转TYPE-C, 二插转三插(继承方法实现)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Decorator</span></span><br><span class="line"><span class="keyword">const</span> ori = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.read = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'我只看得懂中文'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Decorator = <span class="function"><span class="keyword">function</span>(<span class="params">ori</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.read= ori.read;</span><br><span class="line">    <span class="keyword">this</span>.readEnglish = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'我还懂英文'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> old = ori()</span><br><span class="line"><span class="keyword">const</span> newObj = <span class="keyword">new</span> Decorator(old)</span><br><span class="line">newObj.readEnglish()</span><br></pre></td></tr></table></figure>

<h3><span id="4代理模式">4.代理模式</span></h3><p>VPN,黄牛,(保姆?),中间人,助手,Proxy.</p>
<p>由proxy代理操作对象本体,脏活累活交给助理(?),不用对对象本身操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例子一,拦截某些来源的邮件</span></span><br><span class="line"><span class="keyword">const</span> emailList = [<span class="string">'qq.com'</span>,<span class="string">'163.com'</span>,<span class="string">'gmail.com'</span>]</span><br><span class="line"><span class="keyword">const</span> SendEmail = <span class="function"><span class="keyword">function</span>(<span class="params">email</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//发送邮件</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ProxyEmail = <span class="function"><span class="keyword">function</span>(<span class="params">email</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(emailList.includes(email))&#123;   <span class="comment">//要截取email吧?</span></span><br><span class="line">        <span class="comment">//屏蔽</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        SendEmail.call(<span class="keyword">this</span>,email)</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line">ProxyEmail(<span class="string">'abcd.com'</span>)</span><br><span class="line">ProxyEmail(<span class="string">'qq.com'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例子二,动态设置img的src</span></span><br><span class="line"><span class="keyword">var</span> domImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> imgEle = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">    <span class="built_in">document</span>.body.append(imgEle);</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">        setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>)</span>&#123;</span><br><span class="line">            imgEle.src= src</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="keyword">var</span> ProxyImg = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        domImage.setSrc(<span class="keyword">this</span>.src)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">        setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>)</span>&#123;</span><br><span class="line">            domImage.setSrc(<span class="string">'./loading.gif'</span>)      <span class="comment">//预设置img为加载的gif图</span></span><br><span class="line">            img.src= src</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)()</span><br><span class="line">ProxyImg.setSrc(<span class="string">'./product.png'</span>)</span><br></pre></td></tr></table></figure>

<h2><span id="5责任链模式">5.责任链模式</span></h2><p><strong>“避免请求发送者与接收者耦合在一起，让多个对象都有可能接受请求，将这些对象连接成一条链，并且沿着这条链传递请求，直到有对象处理它为止”</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不运用模式的写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//...一段逻辑</span></span><br><span class="line">    step2()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    step3()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="comment">//More steps...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//弊端:如果需要插入步骤，则逻辑修改麻烦</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//运用责任链模式的写法</span></span><br><span class="line"><span class="comment">//仅为思路,以下代码实际好像不能运行(?)</span></span><br><span class="line"><span class="keyword">const</span> Chain = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.fn = fn;</span><br><span class="line">    <span class="keyword">this</span>.setNext = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.run = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> f1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> ChainF1 = <span class="keyword">new</span> Chain(f1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> f2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> ChainF2 = <span class="keyword">new</span> Chain(f2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> f3 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> ChainF3 = <span class="keyword">new</span> Chain(f3)</span><br><span class="line"></span><br><span class="line">ChainF1.setNext(ChainF2).setNext(ChainF3);</span><br><span class="line">ChainF1.run()</span><br></pre></td></tr></table></figure>

<ul>
<li>思路1: this.fn = fn ==&gt;设置起点, 每一个实例自身都可以当作责任链的开头</li>
<li>​        2: this.setNext = function(){}     设置链的下家,同样需要实例</li>
<li>​        3: this.run = function(){}            启动责任链</li>
<li>思路2:  每个节点都有自己的名字,调用handle时传入名字,如果名字相同,则责任链执行完成.如果next非空,则传给next的handler.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//思路2的实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  setNext(handler) &#123;</span><br><span class="line">    <span class="keyword">this</span>.next = handler;      <span class="comment">//关键点</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(...props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(...props);</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"log"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  handle(level, msg) &#123;</span><br><span class="line">    <span class="keyword">if</span> (level === <span class="keyword">this</span>.name) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`LOG: <span class="subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.next &amp;&amp; <span class="keyword">this</span>.next.handle(...arguments);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WarnHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(...props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(...props);</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"warn"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  handle(level, msg) &#123;</span><br><span class="line">    <span class="keyword">if</span> (level === <span class="keyword">this</span>.name) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`WARN: <span class="subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.next &amp;&amp; <span class="keyword">this</span>.next.handle(...arguments);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(...props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(...props);</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"error"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  handle(level, msg) &#123;</span><br><span class="line">    <span class="keyword">if</span> (level === <span class="keyword">this</span>.name) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`ERROR: <span class="subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.next &amp;&amp; <span class="keyword">this</span>.next.handle(...arguments);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> logHandler = <span class="keyword">new</span> LogHandler();</span><br><span class="line"><span class="keyword">let</span> warnHandler = <span class="keyword">new</span> WarnHandler();</span><br><span class="line"><span class="keyword">let</span> errorHandler = <span class="keyword">new</span> ErrorHandler();</span><br><span class="line"><span class="comment">// 设置下一个处理的节点</span></span><br><span class="line">logHandler.setNext(warnHandler);      <span class="comment">//是否可以改为链式?</span></span><br><span class="line">warnHandler.setNext(errorHandler);</span><br><span class="line">logHandler.handle(<span class="string">"error"</span>, <span class="string">"Some error occur"</span>);</span><br></pre></td></tr></table></figure>



<p>文章内容:<a href="https://juejin.im/post/5e0eaff4e51d45413b7b77f3" target="_blank" rel="noopener">https://juejin.im/post/5e0eaff4e51d45413b7b77f3</a></p>
<p>本文为个人理解+文章摘抄.</p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->

<script src="/js/highlight.pack.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

